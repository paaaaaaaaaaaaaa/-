<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Публикация в ВКонтакте | КиберСфера</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚡</text></svg>" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --neon-cyan: #00f3ff;
      --neon-pink: #ff00c8;
      --neon-purple: #9d00ff;
      --neon-green: #00ff88;
      --neon-yellow: #ffee00;
      --neon-orange: #ff7700;
      --neon-red: #ff0000;
      --dark-bg: #0a0a12;
      --darker-bg: #050508;
      --panel-bg: rgba(15, 15, 25, 0.9);
      --text-primary: #e0e0ff;
      --text-secondary: #a0a0c0;
      --glow-cyan: 0 0 10px rgba(0, 243, 255, 0.7), 0 0 20px rgba(0, 243, 255, 0.5), 0 0 30px rgba(0, 243, 255, 0.3);
      --glow-pink: 0 0 10px rgba(255, 0, 200, 0.7), 0 0 20px rgba(255, 0, 200, 0.5), 0 0 30px rgba(255, 0, 200, 0.3);
      --glow-purple: 0 0 10px rgba(157, 0, 255, 0.7), 0 0 20px rgba(157, 0, 255, 0.5), 0 0 30px rgba(157, 0, 255, 0.3);
      --glow-red: 0 0 10px rgba(255, 0, 0, 0.7), 0 0 20px rgba(255, 0, 0, 0.5), 0 0 30px rgba(255, 0, 0, 0.3);
    }

    /* Светлая тема */
    .light-theme {
      --neon-cyan: #008cff;
      --neon-pink: #d400a6;
      --neon-purple: #7a00cc;
      --neon-green: #00cc6a;
      --neon-yellow: #e6d800;
      --neon-orange: #e65c00;
      --neon-red: #cc0000;
      --dark-bg: #f0f2f5;
      --darker-bg: #e1e5eb;
      --panel-bg: rgba(255, 255, 255, 0.95);
      --text-primary: #1a1a2e;
      --text-secondary: #4a4a6e;
      --glow-cyan: 0 0 10px rgba(0, 140, 255, 0.5), 0 0 20px rgba(0, 140, 255, 0.3);
      --glow-pink: 0 0 10px rgba(212, 0, 166, 0.5), 0 0 20px rgba(212, 0, 166, 0.3);
      --glow-purple: 0 0 10px rgba(122, 0, 204, 0.5), 0 0 20px rgba(122, 0, 204, 0.3);
      --glow-red: 0 0 10px rgba(204, 0, 0, 0.5), 0 0 20px rgba(204, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Orbitron', monospace;
      background-color: var(--dark-bg);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
      min-height: 100vh;
      transition: all 0.5s ease;
    }

    /* Улучшенный киберпанк фон */
    .cyber-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -4;
      background: 
        radial-gradient(circle at 20% 30%, rgba(0, 243, 255, 0.08) 0%, transparent 25%),
        radial-gradient(circle at 80% 70%, rgba(255, 0, 200, 0.08) 0%, transparent 25%),
        radial-gradient(circle at 40% 80%, rgba(157, 0, 255, 0.08) 0%, transparent 25%),
        radial-gradient(circle at 60% 20%, rgba(0, 255, 136, 0.08) 0%, transparent 25%),
        linear-gradient(135deg, #0a0a12 0%, #0d0d1a 50%, #0a0a12 100%);
    }

    .light-theme .cyber-bg {
      background: 
        radial-gradient(circle at 20% 30%, rgba(0, 140, 255, 0.08) 0%, transparent 25%),
        radial-gradient(circle at 80% 70%, rgba(212, 0, 166, 0.08) 0%, transparent 25%),
        radial-gradient(circle at 40% 80%, rgba(122, 0, 204, 0.08) 0%, transparent 25%),
        radial-gradient(circle at 60% 20%, rgba(0, 204, 106, 0.08) 0%, transparent 25%),
        linear-gradient(135deg, #f0f2f5 0%, #e1e5eb 50%, #f0f2f5 100%);
    }

    .grid-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
      background-size: 40px 40px;
      z-index: -3;
      opacity: 0.4;
      animation: gridMove 20s linear infinite;
    }

    .light-theme .grid-overlay {
      background-image: 
        linear-gradient(rgba(0, 140, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 140, 255, 0.05) 1px, transparent 1px);
    }

    @keyframes gridMove {
      0% { transform: translate(0, 0); }
      100% { transform: translate(40px, 40px); }
    }

    .scanline {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--neon-cyan), var(--neon-pink), transparent);
      z-index: -2;
      animation: scan 6s linear infinite;
      opacity: 0.5;
      box-shadow: 0 0 10px var(--neon-cyan);
    }

    @keyframes scan {
      0% { top: 0%; opacity: 0; }
      10% { opacity: 0.7; }
      90% { opacity: 0.7; }
      100% { top: 100%; opacity: 0; }
    }

    /* Плавающие частицы */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--neon-cyan);
      box-shadow: 0 0 10px var(--neon-cyan);
      animation: float 15s infinite linear;
    }

    .particle:nth-child(2n) {
      background: var(--neon-pink);
      box-shadow: 0 0 10px var(--neon-pink);
    }

    .particle:nth-child(3n) {
      background: var(--neon-purple);
      box-shadow: 0 0 10px var(--neon-purple);
    }

    .particle:nth-child(4n) {
      background: var(--neon-green);
      box-shadow: 0 0 10px var(--neon-green);
    }

    @keyframes float {
      0% {
        transform: translateY(100vh) translateX(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100px) translateX(100px);
        opacity: 0;
      }
    }

    /* УПРОЩЕННАЯ ШАПКА - ТОЛЬКО ЛОГОТИП И НАСТРОЙКИ */
    header {
      background: rgba(10, 10, 18, 0.95);
      backdrop-filter: blur(15px);
      border-bottom: 1px solid rgba(0, 243, 255, 0.3);
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
    }

    .light-theme header {
      background: rgba(255, 255, 255, 0.95);
      border-bottom: 1px solid rgba(0, 140, 255, 0.3);
    }

    .header-container {
      max-width: 2200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 1rem;
    }

    /* ЛОГОТИП СЛЕВА */
    .logo {
      display: flex;
      align-items: center;
      gap: 1rem;
      cursor: pointer;
      text-decoration: none;
    }

    .logo-icon {
      width: 65px;
      height: 65px;
      border-radius: 50%;
      background: conic-gradient(from 0deg, var(--neon-cyan), var(--neon-pink), var(--neon-purple), var(--neon-cyan));
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      animation: rotate 8s linear infinite;
      box-shadow: var(--glow-cyan);
    }

    .logo-icon::before {
      content: '';
      position: absolute;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--dark-bg);
    }

    .logo-icon::after {
      content: '';
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--neon-cyan);
      box-shadow: 0 0 10px var(--neon-cyan);
    }

    .logo-text {
      font-size: 2.2rem;
      font-weight: 900;
      background: linear-gradient(90deg, var(--neon-cyan), var(--neon-pink), var(--neon-purple));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
    }

    /* Основной контейнер - ТЕПЕРЬ ВЕРТИКАЛЬНЫЙ */
    .container {
      display: flex;
      flex-direction: column;
      gap: 30px;
      padding: 30px;
      max-width: 1000px;
      margin: 0 auto;
      width: 100%;
      position: relative;
      z-index: 2;
    }

    /* Панели */
    .panel {
      width: 100%;
      background: var(--panel-bg);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.5),
        inset 0 0 30px rgba(0, 243, 255, 0.1);
      display: flex;
      flex-direction: column;
      border: 1px solid rgba(0, 243, 255, 0.3);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .light-theme .panel {
      box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.2),
        inset 0 0 30px rgba(0, 140, 255, 0.1);
      border: 1px solid rgba(0, 140, 255, 0.3);
    }

    .panel:hover {
      box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.6),
        inset 0 0 40px rgba(0, 243, 255, 0.15);
      transform: translateY(-5px);
    }

    .light-theme .panel:hover {
      box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.3),
        inset 0 0 40px rgba(0, 140, 255, 0.15);
    }

    .panel h2 {
      color: transparent;
      background-clip: text;
      -webkit-background-clip: text;
      background-image: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-pink) 100%);
      margin-bottom: 25px;
      font-size: 2rem;
      font-weight: 700;
      text-align: center;
      border-bottom: 2px solid var(--neon-cyan);
      padding-bottom: 15px;
      text-shadow: 0 0 15px rgba(0, 243, 255, 0.5);
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .light-theme .panel h2 {
      text-shadow: 0 0 15px rgba(0, 140, 255, 0.5);
    }

    /* Формы */
    .post-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      color: var(--neon-cyan);
      font-weight: bold;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    input, textarea, select {
      padding: 14px 18px;
      border-radius: 8px;
      border: 1px solid rgba(0, 243, 255, 0.4);
      background: rgba(255, 255, 255, 0.08);
      color: var(--text-primary);
      font-size: 1rem;
      transition: all 0.3s ease;
      font-family: 'Orbitron', monospace;
    }

    .light-theme input,
    .light-theme textarea,
    .light-theme select {
      border: 1px solid rgba(0, 140, 255, 0.4);
      background: rgba(0, 0, 0, 0.05);
      color: var(--text-primary);
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--neon-cyan);
      box-shadow: 0 0 15px rgba(0, 243, 255, 0.5);
      background: rgba(255, 255, 255, 0.12);
    }

    .light-theme input:focus,
    .light-theme textarea:focus,
    .light-theme select:focus {
      border-color: var(--neon-cyan);
      box-shadow: 0 0 15px rgba(0, 140, 255, 0.5);
      background: rgba(0, 0, 0, 0.08);
    }

    textarea {
      min-height: 150px;
      resize: vertical;
    }

    /* Информация о платформе */
    .platform-info {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 20px;
      background: rgba(0, 243, 255, 0.1);
      border-radius: 12px;
      border: 1px solid var(--neon-cyan);
      transition: all 0.3s ease;
    }

    .light-theme .platform-info {
      background: rgba(0, 140, 255, 0.1);
      border: 1px solid var(--neon-cyan);
    }

    .platform-info:hover {
      background: rgba(0, 243, 255, 0.15);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 243, 255, 0.3);
    }

    .light-theme .platform-info:hover {
      background: rgba(0, 140, 255, 0.15);
      box-shadow: 0 5px 15px rgba(0, 140, 255, 0.3);
    }

    .platform-icon {
      font-size: 3.5rem;
      color: var(--neon-cyan);
      filter: drop-shadow(0 0 10px var(--neon-cyan));
    }

    .platform-details {
      flex: 1;
    }

    .platform-name {
      font-size: 1.6rem;
      font-weight: bold;
      color: var(--neon-cyan);
      margin-bottom: 8px;
    }

    .platform-status {
      color: var(--neon-green);
      font-size: 1rem;
      font-weight: bold;
    }

    /* Кнопки */
    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    button {
      flex: 1;
      padding: 16px 20px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
      min-width: 220px;
      font-family: 'Orbitron', monospace;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn-primary {
      background: transparent;
      color: var(--neon-cyan);
      border: 2px solid var(--neon-cyan);
      box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 243, 255, 0.3), transparent);
      transition: left 0.5s;
    }

    .btn-primary:hover:not(:disabled) {
      background: rgba(0, 243, 255, 0.15);
      transform: translateY(-5px);
      box-shadow: 0 0 25px rgba(0, 243, 255, 0.7);
    }

    .btn-primary:hover:not(:disabled)::before {
      left: 100%;
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: rgba(0, 243, 255, 0.2);
      color: var(--text-primary);
      border: 2px solid var(--neon-cyan);
      box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
    }

    .btn-secondary:hover:not(:disabled) {
      background: rgba(0, 243, 255, 0.3);
      transform: translateY(-5px);
      box-shadow: 0 0 25px rgba(0, 243, 255, 0.4);
    }

    .btn-secondary:active:not(:disabled) {
      transform: translateY(-2px);
    }

    /* Сообщения статуса */
    .status-message {
      padding: 16px;
      border-radius: 8px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
      display: none;
      animation: fadeIn 0.3s ease;
      font-size: 1.1rem;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .success {
      background: rgba(0, 255, 136, 0.2);
      color: var(--neon-green);
      border: 1px solid var(--neon-green);
      box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
    }

    .error {
      background: rgba(255, 0, 0, 0.2);
      color: var(--neon-red);
      border: 1px solid var(--neon-red);
      box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
    }

    /* Индикатор загрузки */
    .button-loading {
      position: relative;
      color: transparent !important;
    }

    .button-loading::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Переключатели */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 65px;
      height: 36px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(26, 15, 56, 0.8);
      border: 2px solid var(--neon-cyan);
      transition: .4s;
      border-radius: 36px;
    }

    .light-theme .toggle-slider {
      background-color: rgba(0, 140, 255, 0.2);
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 28px;
      width: 28px;
      left: 2px;
      bottom: 2px;
      background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-pink) 100%);
      transition: .4s;
      border-radius: 50%;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    input:checked + .toggle-slider {
      background-color: rgba(0, 243, 255, 0.2);
    }

    .light-theme input:checked + .toggle-slider {
      background-color: rgba(0, 140, 255, 0.4);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(29px);
    }

    /* История */
    .history-item {
      background: rgba(0, 243, 255, 0.1);
      border-radius: 8px;
      padding: 18px;
      margin-bottom: 12px;
      border: 1px solid var(--neon-cyan);
      transition: all 0.3s ease;
    }

    .light-theme .history-item {
      background: rgba(0, 140, 255, 0.1);
      border: 1px solid var(--neon-cyan);
    }

    .history-item:hover {
      background: rgba(0, 243, 255, 0.15);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 243, 255, 0.2);
    }

    .light-theme .history-item:hover {
      background: rgba(0, 140, 255, 0.15);
      box-shadow: 0 5px 15px rgba(0, 140, 255, 0.2);
    }

    .history-text {
      margin-bottom: 12px;
      line-height: 1.5;
      color: var(--text-primary);
    }

    .history-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .history-status {
      color: var(--neon-green);
      font-weight: bold;
    }

    /* API статус */
    .api-status {
      margin-top: 12px;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      font-size: 1rem;
      font-weight: bold;
    }

    .api-status.connected {
      background: rgba(0, 255, 136, 0.2);
      color: var(--neon-green);
      border: 1px solid var(--neon-green);
      box-shadow: 0 3px 10px rgba(0, 255, 136, 0.2);
    }

    .api-status.error {
      background: rgba(255, 0, 0, 0.2);
      color: var(--neon-red);
      border: 1px solid var(--neon-red);
      box-shadow: 0 3px 10px rgba(255, 0, 0, 0.2);
    }

    /* Отладочная информация */
    .debug-info {
      background: rgba(0, 243, 255, 0.1);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-size: 0.9rem;
      color: var(--text-secondary);
      border: 1px solid var(--neon-cyan);
    }

    .light-theme .debug-info {
      background: rgba(0, 140, 255, 0.1);
    }

    /* Стили для фото */
    .photo-inputs {
      display: flex;
      gap: 12px;
      margin-top: 15px;
    }

    .photo-inputs input {
      flex: 1;
    }

    .preview-image {
      max-width: 100%;
      max-height: 220px;
      border-radius: 12px;
      display: none;
      border: 2px solid var(--neon-cyan);
      margin: 0 auto;
      box-shadow: 0 5px 15px rgba(0, 243, 255, 0.3);
    }

    .photo-preview {
      margin-top: 15px;
      text-align: center;
    }

    .extracted-info {
      background: rgba(0, 255, 136, 0.1);
      padding: 15px;
      border-radius: 12px;
      margin-top: 15px;
      border: 1px solid var(--neon-green);
      font-size: 1rem;
      color: var(--neon-green);
      font-weight: bold;
      display: none;
    }

    .char-counter {
      text-align: right;
      margin-top: 8px;
      color: var(--text-secondary);
      font-size: 1rem;
    }

    .photo-attachment {
      background: rgba(0, 243, 255, 0.1);
      padding: 20px;
      border-radius: 15px;
      margin-top: 15px;
      border: 1px solid var(--neon-cyan);
    }

    .light-theme .photo-attachment {
      background: rgba(0, 140, 255, 0.1);
    }

    .datetime-input {
      display: none;
    }

    .datetime-input.active {
      display: block;
    }

    .local-history {
      max-height: 450px;
      overflow-y: auto;
    }

    .test-buttons {
      display: flex;
      gap: 12px;
      margin-top: 15px;
    }

    .test-btn {
      padding: 10px 18px;
      background: rgba(0, 243, 255, 0.2);
      border: 1px solid var(--neon-cyan);
      color: var(--text-primary);
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      font-family: 'Orbitron', monospace;
      font-weight: bold;
    }

    .light-theme .test-btn {
      background: rgba(0, 140, 255, 0.2);
    }

    .test-btn:hover {
      background: rgba(0, 243, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 243, 255, 0.3);
    }

    .light-theme .test-btn:hover {
      background: rgba(0, 140, 255, 0.3);
      box-shadow: 0 5px 15px rgba(0, 140, 255, 0.3);
    }

    /* Настройки */
    .settings-container {
      position: relative;
    }

    .settings-btn {
      background: transparent;
      border: none;
      color: var(--neon-cyan);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
    }

    .settings-btn:hover {
      background: rgba(0, 243, 255, 0.1);
      transform: rotate(90deg);
    }

    .light-theme .settings-btn:hover {
      background: rgba(0, 140, 255, 0.1);
    }

    .settings-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--panel-bg);
      border: 1px solid rgba(0, 243, 255, 0.3);
      border-radius: 10px;
      padding: 1.5rem;
      min-width: 280px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      backdrop-filter: blur(10px);
      transform: translateY(10px);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .light-theme .settings-dropdown {
      border: 1px solid rgba(0, 140, 255, 0.3);
    }

    .settings-dropdown.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .settings-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: var(--neon-cyan);
      text-transform: uppercase;
      letter-spacing: 1px;
      text-align: center;
    }

    .setting-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(0, 243, 255, 0.1);
    }

    .light-theme .setting-option {
      border-bottom: 1px solid rgba(0, 140, 255, 0.1);
    }

    .setting-label {
      color: var(--text-primary);
      font-weight: 500;
    }

    /* Переключатели */
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 243, 255, 0.2);
      transition: .4s;
      border-radius: 34px;
    }

    .light-theme .slider {
      background-color: rgba(0, 140, 255, 0.2);
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: var(--neon-cyan);
      transition: .4s;
      border-radius: 50%;
      box-shadow: 0 0 10px var(--neon-cyan);
    }

    input:checked + .slider {
      background-color: rgba(0, 243, 255, 0.4);
    }

    .light-theme input:checked + .slider {
      background-color: rgba(0, 140, 255, 0.4);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    /* ИСПРАВЛЕННАЯ ШЕСТЕРЁНКА */
    .advanced-gear {
      width: 24px;
      height: 24px;
      position: relative;
      transition: all 0.4s ease;
    }

    .advanced-gear::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(from 0deg, var(--neon-cyan), var(--neon-pink), var(--neon-purple), var(--neon-cyan));
      mask: radial-gradient(circle at center, transparent 30%, black 31%);
      -webkit-mask: radial-gradient(circle at center, transparent 30%, black 31%);
      animation: rotate 3s linear infinite paused;
      box-shadow: 0 0 5px var(--neon-cyan);
      transition: all 0.4s ease;
    }

    .settings-btn:hover .advanced-gear::before {
      animation-play-state: running;
      box-shadow: 0 0 8px var(--neon-pink);
    }

    .advanced-gear::after {
      content: '';
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--neon-cyan);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 5px var(--neon-cyan);
      transition: all 0.4s ease;
    }

    .settings-btn:hover .advanced-gear::after {
      background: var(--neon-pink);
      box-shadow: 0 0 8px var(--neon-pink);
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Анимация логотипа */
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Адаптивность */
    @media (max-width: 768px) {
      .header-container {
        flex-direction: column;
        gap: 12px;
        padding: 15px;
      }
      
      .container {
        padding: 20px;
        gap: 20px;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      button {
        min-width: auto;
      }
      
      .platform-info {
        flex-direction: column;
        text-align: center;
        gap: 15px;
      }
    }
    
    @media (max-width: 480px) {
      .panel {
        padding: 20px;
      }
      
      .panel h2 {
        font-size: 1.6rem;
      }
    }
  </style>
</head>
<body>
  <!-- Киберпанк фон -->
  <div class="cyber-bg"></div>
  <div class="grid-overlay"></div>
  <div class="scanline"></div>
  <div class="particles" id="particles"></div>

  <!-- УПРОЩЕННАЯ ШАПКА - ТОЛЬКО ЛОГОТИП И НАСТРОЙКИ -->
  <header>
    <div class="header-container">
      <!-- Логотип слева с ссылкой на главную -->
      <a href="index.php" class="logo">
        <div class="logo-icon"></div>
        <div class="logo-text">КиберСфера</div>
      </a>
      
      <!-- Кнопка настроек с улучшенной шестерёнкой -->
      <div class="settings-container">
        <button class="settings-btn" id="settings-btn">
          <!-- Улучшенная шестерёнка -->
          <div class="advanced-gear"></div>
        </button>
        <div class="settings-dropdown" id="settings-dropdown">
          <h3 class="settings-title">Настройки</h3>
          <div class="setting-option">
            <span class="setting-label">Светлая тема</span>
            <label class="switch">
              <input type="checkbox" id="theme-switch">
              <span class="slider"></span>
            </label>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- ВЕРТИКАЛЬНЫЙ КОНТЕЙНЕР - сначала создание поста, потом история -->
  <div class="container">
    <div class="panel">
      <h2>Создание поста</h2>
      <form class="post-form" id="postForm">
        <div class="form-group">
          <div class="platform-info">
            <i class="fab fa-vk platform-icon"></i>
            <div class="platform-details">
              <div class="platform-name">ВКонтакте</div>
              <div class="platform-status">✓ Подключено к группе ID: 233256913</div>
              <div id="apiStatus" class="api-status">
                <i class="fas fa-sync fa-spin"></i> Проверка подключения...
              </div>
              <div class="test-buttons">
                <button type="button" class="test-btn" onclick="testConnection()">Тест подключения</button>
                <button type="button" class="test-btn" onclick="testPostPublishing()">Тест публикации</button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="postText"><i class="fas fa-edit"></i> Текст поста</label>
          <textarea id="postText" placeholder="Введите текст для публикации в ВКонтакте..." maxlength="4000"></textarea>
          <div class="char-counter">
            <span id="charCount">0</span>/4000 символов
          </div>
        </div>

        <div class="form-group">
          <label><i class="fas fa-image"></i> Прикрепление фото из ВКонтакте</label>
          <div class="photo-attachment">
            <p><strong>Вставьте ссылку на фото из ВКонтакте:</strong></p>
            <div class="photo-inputs">
              <input type="url" id="photoUrl" placeholder="https://vk.com/photo123456789_456239021">
              <button type="button" class="btn-secondary" id="parseUrlBtn">
                <i class="fas fa-link"></i> Извлечь ID
              </button>
            </div>
            <div id="extractedInfo" class="extracted-info" style="display: none;">
              <i class="fas fa-check-circle"></i> ID извлечены: <span id="photoIds"></span>
            </div>
            <div class="photo-preview">
              <img id="previewImage" class="preview-image" src="" alt="Предпросмотр изображения">
            </div>
            <small style="color: var(--text-secondary); margin-top: 8px; display: block;">
              Поддерживаются ссылки на фото из ВКонтакте
            </small>
          </div>
        </div>

        <div class="form-group">
          <label><i class="fas fa-clock"></i> Настройки публикации</label>
          <div class="schedule-options">
            <div class="schedule-toggle">
              <label class="toggle-switch">
                <input type="checkbox" id="scheduleToggle">
                <span class="toggle-slider"></span>
              </label>
              <span>Отложенная публикация</span>
            </div>
            
            <div class="datetime-input" id="datetimeInput">
              <input type="datetime-local" id="scheduleDateTime">
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="schedule-toggle">
            <label class="toggle-switch">
              <input type="checkbox" id="fromGroup" checked>
              <span class="toggle-slider"></span>
            </label>
            <span>Опубликовать от имени сообщества</span>
          </div>
          <div class="schedule-toggle">
            <label class="toggle-switch">
              <input type="checkbox" id="signed" checked>
              <span class="toggle-slider"></span>
            </label>
            <span>Подписать автора (администратора)</span>
          </div>
        </div>
        
        <div class="button-group">
          <button type="button" class="btn-primary" id="publishBtn">
            <i class="fas fa-paper-plane"></i> Опубликовать в ВК
          </button>
          <button type="button" class="btn-secondary" id="previewBtn">
            <i class="fas fa-eye"></i> Предпросмотр
          </button>
        </div>
        
        <div class="status-message success" id="successMessage">
          <i class="fas fa-check-circle"></i> Пост успешно опубликован в ВКонтакте!
        </div>
        
        <div class="status-message error" id="errorMessage">
          <i class="fas fa-exclamation-triangle"></i> Произошла ошибка при публикации
        </div>

        <div class="debug-info" id="debugInfo">
          Режим отладки: информация о запросах будет отображаться здесь
        </div>
      </form>
    </div>
    
    <!-- История публикаций теперь под созданием поста -->
    <div class="panel">
      <h2>История публикаций</h2>
      <div class="form-group">
        <input type="text" id="searchHistory" placeholder="Поиск по истории...">
      </div>
      <div class="local-history">
        <div id="historyList">
          <div class="history-item">
            <div class="history-text">Здесь будет отображаться история ваших постов</div>
            <div class="history-meta">
              <span>--.--.---- --:--</span>
              <span class="history-status">Готов</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Функция для создания частиц
    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      const particleCount = 25;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // Случайные начальные позиции
        const left = Math.random() * 100;
        const size = Math.random() * 3 + 1;
        const opacity = Math.random() * 0.5 + 0.2;
        const animationDuration = Math.random() * 20 + 10;
        const animationDelay = Math.random() * 5;
        
        particle.style.left = `${left}%`;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.opacity = opacity;
        particle.style.animationDuration = `${animationDuration}s`;
        particle.style.animationDelay = `${animationDelay}s`;
        
        particlesContainer.appendChild(particle);
      }
    }

    // Токен и ID группы
    const VK_TOKEN = 'vk1.a.2iirdPpmmI9I1dqxEHOHEeowx7D6XlcEkzz9jnWCB8ZDCzpQ0joviO2Md6v8i15uST4Y6Ynftqm7WM6iP5Rv44gf-fGxISWJ53pl_QXXNuanY5ILbx1idsceI9nymrQUfj9O--v_Ltz6csbIgCSmCE8btYyRng5DMxilZoEneq9weO8uzhSEX-ps5r03FqUFZxl4GMK9DUIkuo1TnvAsdg';
    const GROUP_ID = '-233571638';
    let localHistory = JSON.parse(localStorage.getItem('vk_publish_history') || '[]');
    let extractedPhotoIds = [];

    // Инициализация
    document.addEventListener('DOMContentLoaded', function() {
      createParticles();
      initializeScheduleToggle();
      checkTokenValidity();
      loadLocalHistory();
      setupCharCounter();
      setupUrlParser();
      initSettings();
      
      // Загружаем черновик если есть
      const savedDraft = localStorage.getItem('vk_draft');
      if (savedDraft) {
        document.getElementById('postText').value = savedDraft;
        document.getElementById('charCount').textContent = savedDraft.length;
      }
    });

    // Инициализация настроек
    function initSettings() {
      // Загружаем настройки из localStorage
      const isLightTheme = localStorage.getItem('lightTheme') === 'true';
      
      // Применяем настройки
      if (isLightTheme) {
        document.body.classList.add('light-theme');
        document.getElementById('theme-switch').checked = true;
      }
      
      // Обработчики для переключателей темы
      document.getElementById('theme-switch').addEventListener('change', function() {
        toggleTheme(this.checked);
      });

      // Настройки - открытие/закрытие выпадающего меню
      document.getElementById('settings-btn').addEventListener('click', function(e) {
        e.stopPropagation();
        document.getElementById('settings-dropdown').classList.toggle('active');
      });

      // Закрытие выпадающих меню при клике вне их
      document.addEventListener('click', function() {
        document.getElementById('settings-dropdown').classList.remove('active');
      });
    }

    function toggleTheme(isLight) {
      if (isLight) {
        document.body.classList.add('light-theme');
        localStorage.setItem('lightTheme', 'true');
      } else {
        document.body.classList.remove('light-theme');
        localStorage.setItem('lightTheme', 'false');
      }
    }

    // Счетчик символов
    function setupCharCounter() {
      const postText = document.getElementById('postText');
      const charCount = document.getElementById('charCount');
      
      postText.addEventListener('input', function() {
        charCount.textContent = this.value.length;
      });
    }

    // Парсер ссылок ВК
    function setupUrlParser() {
      const parseBtn = document.getElementById('parseUrlBtn');
      const photoUrl = document.getElementById('photoUrl');
      
      parseBtn.addEventListener('click', function() {
        const url = photoUrl.value.trim();
        if (!url) {
          showMessage('Введите ссылку на фото', 'error');
          return;
        }
        
        const photoIds = extractPhotoIdsFromUrl(url);
        if (photoIds.length > 0) {
          extractedPhotoIds = photoIds;
          displayExtractedIds(photoIds);
          showMessage(`Успешно извлечено ${photoIds.length} ID фото`, 'success');
          loadPhotoPreview(photoIds[0]);
        } else {
          showMessage('Не удалось извлечь ID фото из ссылки', 'error');
        }
      });
      
      // Автоматический парсинг при вставке
      photoUrl.addEventListener('paste', function(e) {
        setTimeout(() => {
          const url = photoUrl.value.trim();
          const photoIds = extractPhotoIdsFromUrl(url);
          if (photoIds.length > 0) {
            extractedPhotoIds = photoIds;
            displayExtractedIds(photoIds);
            loadPhotoPreview(photoIds[0]);
          }
        }, 100);
      });
    }

    // Извлечение ID фото из различных форматов ссылок ВК
    function extractPhotoIdsFromUrl(url) {
      const patterns = [
        // photo123456789_456239021
        /photo(-?\d+)_(\d+)/,
        // https://vk.com/photo123456789_456239021
        /vk\.com\/photo(-?\d+)_(\d+)/,
        // https://vk.com/wall123456789?z=photo123456789_456239021
        /z=photo(-?\d+)_(\d+)/,
        // albums123456789/456239021
        /albums(-?\d+)\/(\d+)/,
        // photos123456789/456239021
        /photos(-?\d+)\/(\d+)/
      ];
      
      const photoIds = [];
      
      for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match) {
          const ownerId = match[1];
          const photoId = match[2];
          photoIds.push(`${ownerId}_${photoId}`);
        }
      }
      
      return photoIds;
    }

    // Отображение извлеченных ID
    function displayExtractedIds(photoIds) {
      const extractedInfo = document.getElementById('extractedInfo');
      const photoIdsSpan = document.getElementById('photoIds');
      
      photoIdsSpan.textContent = photoIds.map(id => `photo${id}`).join(', ');
      extractedInfo.style.display = 'block';
    }

    // Загрузка превью фото - ИСПРАВЛЕННАЯ ФУНКЦИЯ
    function loadPhotoPreview(photoId) {
      const previewImage = document.getElementById('previewImage');
      
      // Получаем информацию о фото через VK API
      callVKAPI('photos.getById', { photos: photoId })
        .then(response => {
          if (response && response.length > 0) {
            const photo = response[0];
            // Используем URL изображения среднего размера
            const url = photo.photo_604 || photo.photo_130 || photo.photo_75;
            if (url) {
              previewImage.src = url;
              previewImage.style.display = 'block';
              previewImage.onload = function() {
                // Фото загружено успешно
                showMessage('Превью фото успешно загружено', 'success');
              };
              previewImage.onerror = function() {
                // Если не удалось загрузить через API, пробуем альтернативные URL
                tryAlternativeUrls(photoId);
              };
            } else {
              tryAlternativeUrls(photoId);
            }
          } else {
            tryAlternativeUrls(photoId);
          }
        })
        .catch(error => {
          console.error('Ошибка загрузки превью через API:', error);
          tryAlternativeUrls(photoId);
        });
    }

    // Альтернативный способ загрузки превью
    function tryAlternativeUrls(photoId) {
      const previewImage = document.getElementById('previewImage');
      
      // Пробуем разные варианты URL для превью
      const previewUrls = [
        `https://sun9-71.userapi.com/impg/${photoId.replace('_', '/')}.jpg`,
        `https://sun1-87.userapi.com/impg/${photoId.replace('_', '/')}.jpg`,
        `https://sun9-74.userapi.com/impg/${photoId.replace('_', '/')}.jpg`
      ];
      
      let currentUrlIndex = 0;
      
      function tryNextUrl() {
        if (currentUrlIndex >= previewUrls.length) {
          previewImage.style.display = 'none';
          showMessage('Не удалось загрузить превью фото', 'error');
          return;
        }
        
        previewImage.src = previewUrls[currentUrlIndex];
        previewImage.style.display = 'block';
        
        previewImage.onload = function() {
          // Фото загружено успешно
          showMessage('Превью фото успешно загружено', 'success');
        };
        
        previewImage.onerror = function() {
          currentUrlIndex++;
          tryNextUrl();
        };
      }
      
      tryNextUrl();
    }

    // Инициализация переключателя расписания
    function initializeScheduleToggle() {
      const scheduleToggle = document.getElementById('scheduleToggle');
      const datetimeInput = document.getElementById('datetimeInput');
      
      if (scheduleToggle && datetimeInput) {
        scheduleToggle.addEventListener('change', function() {
          if (this.checked) {
            datetimeInput.classList.add('active');
            const minDate = new Date(Date.now() + 5 * 60 * 1000);
            document.getElementById('scheduleDateTime').min = minDate.toISOString().slice(0, 16);
            const defaultDate = new Date(Date.now() + 60 * 60 * 1000);
            document.getElementById('scheduleDateTime').value = defaultDate.toISOString().slice(0, 16);
          } else {
            datetimeInput.classList.remove('active');
          }
        });
      }
    }

    // JSONP функция для обхода CORS
    function callVKAPI(method, params = {}) {
      return new Promise((resolve, reject) => {
        const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());
        const script = document.createElement('script');
        
        const baseParams = {
          access_token: VK_TOKEN,
          v: '5.199'
        };
        
        const allParams = { ...baseParams, ...params };
        allParams.callback = callbackName;
        
        const paramString = Object.keys(allParams)
          .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(allParams[key])}`)
          .join('&');
        
        const url = `https://api.vk.com/method/${method}?${paramString}`;
        
        updateDebugInfo(`Отправка запроса: ${method}`);
        
        window[callbackName] = function(data) {
          delete window[callbackName];
          document.body.removeChild(script);
          
          if (data.error) {
            updateDebugInfo(`Ошибка API: ${data.error.error_msg}`);
            reject(new Error(`VK API: ${data.error.error_msg} (код: ${data.error.error_code})`));
          } else {
            updateDebugInfo(`Успешный ответ: ${method}`);
            resolve(data.response);
          }
        };
        
        script.onerror = function() {
          delete window[callbackName];
          document.body.removeChild(script);
          updateDebugInfo('Ошибка загрузки скрипта');
          reject(new Error('Ошибка загрузки скрипта VK API'));
        };
        
        script.src = url;
        document.body.appendChild(script);
      });
    }

    // Тест подключения
    async function testConnection() {
      try {
        showMessage('Тестирование подключения...', 'success');
        const result = await callVKAPI('groups.getById', {
          group_id: '233612410'
        });
        showMessage('✓ Подключение успешно! Можно публиковать посты', 'success');
      } catch (error) {
        showMessage('✗ Ошибка подключения: ' + error.message, 'error');
      }
    }

    // Тест публикации
    async function testPostPublishing() {
      try {
        showMessage('Тест публикации...', 'success');
        const result = await callVKAPI('wall.post', {
          owner_id: GROUP_ID,
          message: 'Тестовый пост от ' + new Date().toLocaleString('ru-RU'),
          from_group: 1,
          signed: 0
        });
        showMessage('✓ Тест успешен! Пост опубликован с ID: ' + result.post_id, 'success');
        addToLocalHistory('Тестовый пост', result.post_id, true);
      } catch (error) {
        showMessage('✗ Ошибка теста: ' + error.message, 'error');
      }
    }

    async function checkTokenValidity() {
      try {
        await callVKAPI('groups.getById', {
          group_id: '233612410'
        });
        
        document.getElementById('apiStatus').className = 'api-status connected';
        document.getElementById('apiStatus').innerHTML = 
          `<i class="fas fa-check-circle"></i> Токен валиден, можно публиковать посты`;
          
      } catch (error) {
        document.getElementById('apiStatus').className = 'api-status error';
        document.getElementById('apiStatus').innerHTML = 
          `<i class="fas fa-exclamation-triangle"></i> Ошибка: ${error.message}`;
      }
    }

    // Публикация поста
    document.getElementById('publishBtn').addEventListener('click', async function() {
      const postText = document.getElementById('postText').value.trim();
      const publishBtn = this;
      
      if (!postText) {
        showMessage('Введите текст поста', 'error');
        return;
      }
      
      publishBtn.classList.add('button-loading');
      publishBtn.disabled = true;
      
      try {
        // Параметры для публикации
        const params = {
          owner_id: GROUP_ID,
          message: postText,
          from_group: document.getElementById('fromGroup').checked ? 1 : 0,
          signed: document.getElementById('signed').checked ? 1 : 0
        };
        
        // Добавляем фото если есть извлеченные ID
        if (extractedPhotoIds.length > 0) {
          const attachments = extractedPhotoIds.map(id => `photo${id}`).join(',');
          params.attachments = attachments;
          updateDebugInfo(`Прикрепляемые фото: ${attachments}`);
        }
        
        // Отложенная публикация
        const scheduleToggle = document.getElementById('scheduleToggle');
        if (scheduleToggle && scheduleToggle.checked) {
          const dateTimeInput = document.getElementById('scheduleDateTime');
          if (dateTimeInput && dateTimeInput.value) {
            const dateTime = new Date(dateTimeInput.value);
            if (dateTime > new Date()) {
              params.publish_date = Math.floor(dateTime.getTime() / 1000);
              updateDebugInfo(`Отложенная публикация: ${dateTime.toLocaleString('ru-RU')}`);
            }
          }
        }
        
        updateDebugInfo(`Публикация поста: ${postText.substring(0, 50)}...`);
        
        // Публикуем пост
        const result = await callVKAPI('wall.post', params);
        
        let successMsg = '✓ Пост успешно опубликован в ВКонтакте! ID: ' + result.post_id;
        if (extractedPhotoIds.length > 0) {
          successMsg += ` с ${extractedPhotoIds.length} фото`;
        }
        showMessage(successMsg, 'success');
        updateDebugInfo(`Пост опубликован с ID: ${result.post_id}`);
        
        // Добавляем в локальную историю
        addToLocalHistory(postText, result.post_id, true);
        
        // Очищаем форму
        resetForm();
        
      } catch (error) {
        const errorMsg = '✗ Ошибка публикации: ' + error.message;
        showMessage(errorMsg, 'error');
        updateDebugInfo(errorMsg);
        
        addToLocalHistory(postText, 'error', false);
        
        console.error('Publish error:', error);
      } finally {
        publishBtn.classList.remove('button-loading');
        publishBtn.disabled = false;
      }
    });

    // Предпросмотр
    document.getElementById('previewBtn').addEventListener('click', function() {
      const postText = document.getElementById('postText').value.trim();
      if (!postText) {
        showMessage('Введите текст поста для предпросмотра', 'error');
        return;
      }
      
      localStorage.setItem('vk_draft', postText);
      
      let previewInfo = 'Текст поста готов к публикации. ';
      if (extractedPhotoIds.length > 0) {
        previewInfo += `Будет прикреплено ${extractedPhotoIds.length} фото`;
      } else {
        previewInfo += 'Фото не прикреплены.';
      }
      
      showMessage(previewInfo, 'success');
    });

    // Локальная история в браузере
    function addToLocalHistory(text, postId, success) {
      const historyItem = {
        id: Date.now(),
        text: text,
        postId: postId,
        success: success,
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleString('ru-RU')
      };
      
      localHistory.unshift(historyItem);
      localHistory = localHistory.slice(0, 50);
      localStorage.setItem('vk_publish_history', JSON.stringify(localHistory));
      
      loadLocalHistory();
    }

    function loadLocalHistory() {
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      
      if (localHistory.length === 0) {
        historyList.innerHTML = `
          <div class="history-item">
            <div class="history-text">История публикаций пуста</div>
            <div class="history-meta">
              <span>--.--.---- --:--</span>
              <span class="history-status">Нет данных</span>
            </div>
          </div>
        `;
        return;
      }
      
      localHistory.forEach(item => {
        const shortText = item.text.length > 100 ? item.text.substring(0, 100) + '...' : item.text;
        const status = item.success ? '✅ Успешно' : '❌ Ошибка';
        const statusColor = item.success ? 'var(--neon-green)' : 'var(--neon-red)';
        
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
          <div class="history-text">${shortText}</div>
          <div class="history-meta">
            <span>${item.date}</span>
            <span class="history-status" style="color: ${statusColor};">${status}</span>
          </div>
          ${item.postId && item.postId !== 'error' ? 
            `<div style="font-size: 0.7rem; color: var(--text-secondary);">ID поста: ${item.postId}</div>` : ''}
        `;
        historyList.appendChild(historyItem);
      });
    }

    // Сброс формы
    function resetForm() {
      document.getElementById('postText').value = '';
      document.getElementById('photoUrl').value = '';
      document.getElementById('charCount').textContent = '0';
      document.getElementById('scheduleToggle').checked = false;
      document.getElementById('datetimeInput').classList.remove('active');
      document.getElementById('extractedInfo').style.display = 'none';
      document.getElementById('previewImage').style.display = 'none';
      extractedPhotoIds = [];
      localStorage.removeItem('vk_draft');
    }

    // Показать сообщение
    function showMessage(text, type) {
      const messageEl = type === 'success' ? 
        document.getElementById('successMessage') : 
        document.getElementById('errorMessage');
      
      messageEl.innerHTML = type === 'success' ? 
        `<i class="fas fa-check-circle"></i> ${text}` :
        `<i class="fas fa-exclamation-triangle"></i> ${text}`;
      
      messageEl.style.display = 'block';
      
      const otherMessageEl = type === 'success' ? 
        document.getElementById('errorMessage') : 
        document.getElementById('successMessage');
      otherMessageEl.style.display = 'none';
      
      setTimeout(() => {
        messageEl.style.display = 'none';
      }, 5000);
    }

    // Обновление отладочной информации
    function updateDebugInfo(message) {
      const debugEl = document.getElementById('debugInfo');
      const timestamp = new Date().toLocaleTimeString();
      debugEl.innerHTML = `<strong>${timestamp}:</strong> ${message}`;
    }

    // Поиск по истории
    document.getElementById('searchHistory').addEventListener('input', function(e) {
      const searchTerm = e.target.value.toLowerCase();
      const historyItems = document.querySelectorAll('.history-item');
      
      historyItems.forEach(item => {
        const text = item.querySelector('.history-text').textContent.toLowerCase();
        if (text.includes(searchTerm)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>